# 설계 및 계획


## UI

UI는 Main ui와 자세한 정보 보기 창 이렇게 2개가 있음

Main에는 '상단 메뉴 항목'들이 있음

- file : 저장, 불러오기

- options : premiscuous mode on/off 버튼(캡쳐 중에는 비활성화), 

- capture : capture, stop

자세한 정보 보기 창에는 접었다 폈다 하는 계층별 data view 창이 필요.

## 실행 flow

실행 flow는 다음과 같음

1. 실행 빈 내용의 기본화면이 띄워짐
2. 캡쳐 버튼을 누른다
3. 캡쳐 옵션 및 네트워크 인터페이스 선택
4. 캡쳐 시작 (5~7)
5. data 구조화
6. 구조화된 data 출력
7. 캡쳐 중지할 때까지 계속함

8. 캡쳐 중지될 경우에 print 된 정보 유지
9. save 할 때, 구조화된 data를 pcap으로 변환
10. 이후 새로운 캡쳐를 시작, 혹은 프로그램 종료


## 함수(기능) 의 역할 및 요구사항

### UI

- 상단 메뉴 항목들 : file, options, capture, 기타 버튼들...

- 상단 메뉴에 항목들 중, 조건이 만족되지 않은 상태에서는 특정 기능 못 누르게 하기
    - 패킷 캡쳐도 안했는데 캡쳐 중지 버튼을 누르지 못하도록 설정
    - 아무것도 캡쳐하지 않았을 땐 저장 버튼을 누르지 못하도록 설정

- 가로 세로 길이는 고정, 창 줄이면 스크롤바 가로 세로로 생기게끔 설정.
    - 전체화면이 기본 화면 크기라 보면 됨
- 패킷 실시간 / 파일에서 로딩되어 보여질 때, 각 패킷 누르면 패킷에 관한 정보를 띄우는 창 새로 생성
- 메뉴의 열 item 중 time, protocol 클릭 시 정렬하는 함수 호출.

### 정렬 함수

- 인자로 정렬 기준 필드(값), 자료구조를 받는다
- 이미 사전 선언한 변수로 시간 기준, 프로토콜 기준 정렬된 data를 저장할 자료구조를 준비해 둔다
- 시간 순서대로 정렬은 사실 필요없은 (받아들여오는 순서대로 넣으면 되서)
- 프로토콜별 정렬은 기존에 등록된 프로토콜별로 자료구조 하나씩 할당 후 들어오는 순서대로 넣어줌.
- main UI에 신호를 보내 새롭게 정렬된 data로 refresh 하게 함.


### handle 함수

- 패킷이 들어오면 pcap에서 호출하는 함수. 해당 데이터에 대해 어떠한 처리를 내릴지 이 함수에서 지정함

- preview에서 보여질 정보만 제외하고 나머지는 분석하지 않는다.

- 전체 data를 관리하는 자료구조에 저장 (시간 순서, protocol 별)

- 메인 UI에 preview data를 여기서 넘겨줘야 할 수도 있음.

- 데이터를 자료구조에 저장한 후에, main  UI에 신호를 보내서 피드를 refresh 하게 함.

### packet data 저장 자료구조

- linked list 사용.

### .pcap format으로의 저장 및 로딩 함수

- pcap file 형식에 맞춰서 저장 및 로딩
- 원본 데이터 + 관리용 구조체로 이루어져 있을거임

### packet data preview 함수

- 해당하는 packet 에서 preview에 필요한 data들만 가져옴

- source/destination ip/mac address, protocol, len, 최상위 계층 정보

### packet data 분석 함수

- OSI layer 를 거쳐가면서 계층별 프로토콜 파악, 데이터 분석.

- 수많은 if문 사용되리라 예상.

### packet raw data print 함수

- raw data를 2, 16진수로 print함.
- offset을 알 수 있게끔 가로, 세로에 0~F, 가로에 0, 10, 20, 30,... 이렇게 있어야 함.

### 상태 표시 구조체

- 현재 프로그램의 상태를 정보를 담고있는 구조체
    - 정렬된 상태, 받아들인 패킷 수, 캡쳐 버튼 누르고 지나온 시간, data를 담은 자료구조 등

### 패킷 저장 구조체

- data 크기
- 원본 data
- preview data

## 역할분담

- 하경
    - 전체 코드 틀 짜기, 코드 합치기, 구조체나 자료구조 type 정의
- 성륜
    - handle 함수 작성
- 민범
    - pcap format으로 저장 및 로딩하는 함수 작성.
- 성운
    - packet data 분석 함수 작성
- 소연
    - Main ui 작성
- 연서
    - 자세한 data view UI 작성.